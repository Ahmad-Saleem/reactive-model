"use strict";function Graph(){function e(e){return o[e]||(o[e]=[])}function n(n,t){e(n).push(t)}function t(n,t){var o={},r=[];return t||(t=function(){return!0}),n.forEach(function i(n){!o[n]&&t(n)&&(o[n]=!0,e(n).forEach(i),r.push(n))}),r}var o={};return{adjacent:e,addEdge:n,DFS:t}}function ReactiveGraph(){function e(){return s++}function n(n){var t=e();return v[t]=n,t}function t(n){var t=e();return p[t]=n,t}function o(e){if(void 0===e.inNodes||void 0===e.outNode)throw new Error("Attempting to add a reactive function that doesn't have inNodes or outNode defined first.");e.inNodes.forEach(function(n){f.addEdge(n,e.node)}),f.addEdge(e.node,e.outNode)}function r(e){var n=e.inNodes.map(i),t=e.callback.apply(null,n);v[e.outNode](t)}function i(e){return v[e]()}function a(){var e=Object.keys(h),n=f.DFS(e,c),t=n.reverse();t.forEach(function(e){e in p&&r(p[e])}),Object.keys(h).forEach(function(e){delete h[e]})}function c(e){if(e in p){var n=p[e],t=n.inNodes.every(function(e){var n=u(i(e));return n});return t}return!0}function u(e){return!("undefined"==typeof e||null===e)}function d(e){h[e]=!0}var f=new Graph,v={},p={},h={},s=0;return f.addReactiveFunction=o,f.makeNode=e,f.digest=a,f.makePropertyNode=n,f.makeReactiveFunctionNode=t,f.propertyNodeDidChange=d,f}function ReactiveFunction(e,n,t){return{inProperties:e,outProperty:n,callback:t,inNodes:void 0,outNode:void 0}}function ReactiveModel(){function e(e,n){if(s)throw new Error("model.addPublicProperty() is being invoked after model.finalize, but this is not allowed. Public properties may only be added before the model is finalized.");return v[e]=n,f}function n(e){return v[e]}function t(){if(s)throw new Error("model.finalize() is being invoked more than once, but this function should only be invoked once.");return s=!0,Object.keys(v).forEach(function(e){a(e),f[e](n(e))}),f}function o(){var e={};return Object.keys(v).forEach(function(n){e[n]=p[n]}),e}function r(e){return Object.keys(v).forEach(function(e){var n=v[e];f[e](n)}),Object.keys(e).forEach(function(n){var t=e[n];f[n](t)}),f}function i(e){var n=ReactiveFunction.parse(e);n.forEach(function(e){d(e),addReactiveFunction(e)})}function a(e){if(e in h)return h[e];var n=c(e);f[e]=n;var t=makePropertyNode(n);return h[e]=t,t}function c(e){return function(n){return arguments.length?(p[e]=n,u(e),f):p[e]}}function u(e){var n=h[e];propertyNodeDidChange(n)}function d(e){e.inNodes=e.inProperties.map(a),e.node=makeReactiveFunctionNode(e),e.outNode=a(e.outProperty)}if(!(this instanceof ReactiveModel))return new ReactiveModel;var f=this,v={},p={},h={},s=!1;f.addPublicProperty=e,f.finalize=t,f.getState=o,f.setState=r,f.react=i}var reactiveGraph=new ReactiveGraph,addReactiveFunction=reactiveGraph.addReactiveFunction,makePropertyNode=reactiveGraph.makePropertyNode,makeReactiveFunctionNode=reactiveGraph.makeReactiveFunctionNode,propertyNodeDidChange=reactiveGraph.propertyNodeDidChange;ReactiveFunction.parse=function(e){return Object.keys(e).map(function(n){var t=e[n],o=t.splice(t.length-1)[0],r=t;return ReactiveFunction(r,n,o)})},ReactiveModel.digest=reactiveGraph.digest,ReactiveModel.Graph=Graph,ReactiveModel.ReactiveGraph=ReactiveGraph,ReactiveModel.ReactiveFunction=ReactiveFunction;var reactiveModel=ReactiveModel;module.exports=reactiveModel;