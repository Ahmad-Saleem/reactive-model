!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.ReactiveModel=n()}(this,function(){"use strict";function e(){function e(e){return o[e]||(o[e]=[])}function n(n,t){e(n).push(t)}function t(n,t){var o={},r=[];return t||(t=function(){return!0}),n.forEach(function i(n){!o[n]&&t(n)&&(o[n]=!0,e(n).forEach(i),r.push(n))}),r}var o={};return{adjacent:e,addEdge:n,DFS:t}}function n(){function n(){return l++}function t(e){var t=n();return s[t]=e,t}function o(e){var t=n();return v[t]=e,t}function r(e){if(void 0===e.inNodes||void 0===e.outNode)throw new Error("Attempting to add a reactive function that doesn't have inNodes or outNode defined first.");e.inNodes.forEach(function(n){d.addEdge(n,e.node)}),d.addEdge(e.node,e.outNode)}function i(e){var n=e.inNodes.map(c);if(n.every(u)){var t=e.callback.apply(null,n);s[e.outNode](t)}}function u(e){return!("undefined"==typeof e||null===e)}function c(e){return s[e]()}function a(){var e=Object.keys(p),n=d.DFS(e),t=n.reverse();t.forEach(function(e){e in v&&i(v[e])}),e.forEach(function(e){delete p[e]})}function f(e){p[e]=!0}var d=new e,s={},v={},p={},l=0;return d.addReactiveFunction=r,d.makeNode=n,d.digest=a,d.makePropertyNode=t,d.makeReactiveFunctionNode=o,d.propertyNodeDidChange=f,d}function t(e){var n=!1;return function(){n||(n=!0,i(function(){n=!1,e()},0))}}function o(e,n,t){var o={inProperties:e,outProperty:n,callback:t,inNodes:void 0,outNode:void 0};return o}function r(){function e(e,n){if(k)throw new Error("model.addPublicProperty() is being invoked after model.finalize, but this is not allowed. Public properties may only be added before the model is finalized.");return b[e]=n,y}function n(e){return b[e]}function t(){if(k)throw new Error("model.finalize() is being invoked more than once, but this function should only be invoked once.");return k=!0,Object.keys(b).forEach(function(e){l(e),y[e](n(e))}),y}function i(){var e={};return Object.keys(b).forEach(function(n){e[n]=N[n]}),e}function u(e){return Object.keys(b).forEach(function(e){var n=b[e];y[e](n)}),Object.keys(e).forEach(function(n){var t=e[n];y[n](t)}),y}function v(e){o.parse(e).forEach(function(e){p(e),c(e)})}function p(e){e.inNodes=e.inProperties.map(l),e.node=f(e),e.outNode=l(e.outProperty)}function l(e){if(e in g)return g[e];var n=h(e),t=a(n);return y[e]=n,g[e]=t,t}function h(e){return function(n){return arguments.length?(N[e]=n,m(e),y):N[e]}}function m(e){var n=g[e];d(n),s()}if(!(this instanceof r))return new r;var y=this,b={},N={},g={},k=!1;y.addPublicProperty=e,y.finalize=t,y.getState=i,y.setState=u,y.react=v}var i="undefined"==typeof requestAnimationFrame?setTimeout:requestAnimationFrame;o.parse=function(e){return Object.keys(e).map(function(n){var t=e[n],r=t.splice(t.length-1)[0],i=t;return o(i,n,r)})};var u=new n,c=u.addReactiveFunction,a=u.makePropertyNode,f=u.makeReactiveFunctionNode,d=u.propertyNodeDidChange,s=t(u.digest);r.digest=u.digest,r.Graph=e,r.ReactiveGraph=n,r.ReactiveFunction=o,r.nextFrame=i;var v=r;return v});