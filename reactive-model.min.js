"use strict";function Graph(){function e(e){return o[e]||(o[e]=[])}function t(t,n){e(t).push(n)}function n(t,n){var o={},r=[];return n||(n=function(){return!0}),t.forEach(function i(t){!o[t]&&n(t)&&(o[t]=!0,e(t).forEach(i),r.push(t))}),r}var o={};return{adjacent:e,addEdge:t,DFS:n}}function ReactiveGraph(){function e(){return v++}function t(t){var n=e();return u[n]=t,n}function n(t){var n=e();return d[n]=t,n}function o(e){if(void 0===e.inNodes||void 0===e.outNode)throw new Error("Attempting to add a reactive function that doesn't have inNodes or outNode defined first.");e.inNodes.forEach(function(t){c.addEdge(t,e.node)}),c.addEdge(e.node,e.outNode)}function r(e){var t=e.inNodes.map(function(e){return u[e]()}),n=e.callback.apply(null,t);u[e.outNode](n)}function i(){var e=Object.keys(f),t=c.DFS(e),n=t.reverse();n.forEach(function(e){e in d&&r(d[e])}),e.forEach(function(e){delete f[e]})}function a(e){f[e]=!0}var c=new Graph,u={},d={},f={},v=0;return c.addReactiveFunction=o,c.makeNode=e,c.digest=i,c.makePropertyNode=t,c.makeReactiveFunctionNode=n,c.propertyNodeDidChange=a,c}function ReactiveFunction(e,t,n){return{inProperties:e,outProperty:t,callback:n,inNodes:void 0,outNode:void 0}}function ReactiveModel(){function e(e,t){if(h)throw new Error("model.addPublicProperty() is being invoked after model.finalize, but this is not allowed. Public properties may only be added before the model is finalized.");return f[e]=t,v[e]=t,d}function t(){if(h)throw new Error("model.finalize() is being invoked more than once, but this function should only be invoked once.");return h=!0,Object.keys(f).map(i),d}function n(){var e={};return Object.keys(f).forEach(function(t){e[t]=v[t]}),e}function o(e){return Object.keys(f).forEach(function(e){var t=f[e];d[e](t)}),Object.keys(e).forEach(function(t){var n=e[t];d[t](n)}),d}function r(e){var t=ReactiveFunction.parse(e);t.forEach(function(e){u(e),addReactiveFunction(e),e.inProperties.forEach(c)})}function i(e){if(e in p)return p[e];var t=a(e);d[e]=t;var n=makePropertyNode(t);return p[e]=n,n}function a(e){return function(t){return arguments.length?(v[e]=t,c(e),d):v[e]}}function c(e){var t=p[e];propertyNodeDidChange(t)}function u(e){e.inNodes=e.inProperties.map(i),e.node=makeReactiveFunctionNode(e),e.outNode=i(e.outProperty)}if(!(this instanceof ReactiveModel))return new ReactiveModel;var d=this,f={},v={},p={},h=!1;d.addPublicProperty=e,d.finalize=t,d.getState=n,d.setState=o,d.react=r}var reactiveGraph=new ReactiveGraph,addReactiveFunction=reactiveGraph.addReactiveFunction,makePropertyNode=reactiveGraph.makePropertyNode,makeReactiveFunctionNode=reactiveGraph.makeReactiveFunctionNode,propertyNodeDidChange=reactiveGraph.propertyNodeDidChange;ReactiveFunction.parse=function(e){return Object.keys(e).map(function(t){var n=e[t],o=n.splice(n.length-1)[0],r=n;return ReactiveFunction(r,t,o)})},ReactiveModel.digest=reactiveGraph.digest,ReactiveModel.Graph=Graph,ReactiveModel.ReactiveGraph=ReactiveGraph,ReactiveModel.ReactiveFunction=ReactiveFunction;var reactiveModel=ReactiveModel;module.exports=reactiveModel;