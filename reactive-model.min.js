"use strict";function Graph(){function e(e){return i[e]||(i[e]=[])}function n(n,t){e(n).push(t)}function t(n,t){i[n]&&(i[n]=i[n]),e(n).push(t)}function o(n,t){var o={},i=[];return t||(t=function(){return!0}),n.forEach(function r(n){!o[n]&&t(n)&&(o[n]=!0,e(n).forEach(r),i.push(n))}),i}var i={};return{adjacent:e,addEdge:n,removeEdge:t,DFS:o}}function ReactiveGraph(){function e(){return a++}function n(n,t){function o(n){var o=e();return c[o]=t[n],o}function i(n){var t=e();return u[t]=n,t}n.inNodes=n.inProperties.map(o),n.node=i(n),n.outNode=o(n.outProperty)}function t(e){if(void 0===e.inNodes||void 0===e.outNode)throw new Error("Attempting to add a reactive function that doesn't have inNodes or outNode defined first.");e.inNodes.forEach(function(n){r.addEdge(n,e.node)}),r.addEdge(e.node,e.outNode)}function o(e){var n=e.inNodes.map(function(e){return c[e]()}),t=e.callback.apply(null,n);c[e.outNode](t)}function i(){var e=Object.keys(d),n=r.DFS(e).reverse();n.forEach(function(e){e in u&&o(u[e])}),e.forEach(function(e){delete d[e]})}var r=new Graph,a=0,c={},u={},d={};return r.addReactiveFunction=t,r.assignNodes=n,r.makeNode=e,r.digest=i,r.changedPropertyNodes=d,r}function ReactiveFunction(e,n,t){return{inProperties:e,outProperty:n,callback:t,inNodes:void 0,outNode:void 0}}function ReactiveModel(){function e(e,n){if(u)throw new Error("model.addPublicProperty() is being invoked after model.finalize, but this is not allowed. Public properties may only be added before the model is finalized.");return c[e]=n,d[e]=n,a}function n(e){e.forEach(function(e){a[e]=function(n){return arguments.length?(d[e]=n,a):d[e]}})}function t(){if(u)throw new Error("model.finalize() is being invoked more than once, but this function should only be invoked once.");return u=!0,n(Object.keys(c)),a}function o(){var e={};return Object.keys(c).forEach(function(n){e[n]=d[n]}),e}function i(e){return Object.keys(c).forEach(function(e){var n=c[e];a[e](n)}),Object.keys(e).forEach(function(n){var t=e[n];a[n](t)}),a}function r(e){var t=ReactiveFunction.parse(e);t.forEach(function(e){n(e.inProperties),n([e.outProperty]),reactiveGraph.assignNodes(e,a),reactiveGraph.addReactiveFunction(e),e.inNodes.forEach(function(e){reactiveGraph.changedPropertyNodes[e]=!0})})}if(!(this instanceof ReactiveModel))return new ReactiveModel;var a=this,c={},u=!1,d={};a.addPublicProperty=e,a.finalize=t,a.getState=o,a.setState=i,a.react=r}var reactiveGraph=new ReactiveGraph;ReactiveFunction.parse=function(e){return Object.keys(e).map(function(n){var t=e[n],o=t.splice(t.length-1)[0],i=t;return ReactiveFunction(i,n,o)})},ReactiveModel.digest=reactiveGraph.digest,ReactiveModel.Graph=Graph,ReactiveModel.ReactiveGraph=ReactiveGraph,ReactiveModel.ReactiveFunction=ReactiveFunction;var reactiveModel=ReactiveModel;module.exports=reactiveModel;