"use strict";function Graph(){function e(e){return o[e]||(o[e]=[])}function n(n,t){e(n).push(t)}function t(n,t){var o={},r=[];return t||(t=function(){return!0}),n.forEach(function i(n){!o[n]&&t(n)&&(o[n]=!0,e(n).forEach(i),r.push(n))}),r}var o={};return{adjacent:e,addEdge:n,DFS:t}}function ReactiveGraph(){function e(){return h++}function n(n){var t=e();return f[t]=n,t}function t(n){var t=e();return v[t]=n,t}function o(e){if(void 0===e.inNodes||void 0===e.outNode)throw new Error("Attempting to add a reactive function that doesn't have inNodes or outNode defined first.");e.inNodes.forEach(function(n){d.addEdge(n,e.node)}),d.addEdge(e.node,e.outNode)}function r(e){var n=e.inNodes.map(a);if(n.every(i)){var t=e.callback.apply(null,n);f[e.outNode](t)}}function i(e){return!("undefined"==typeof e||null===e)}function a(e){return f[e]()}function c(){var e=Object.keys(p),n=d.DFS(e),t=n.reverse();t.forEach(function(e){e in v&&r(v[e])}),e.forEach(function(e){delete p[e]})}function u(e){p[e]=!0}var d=new Graph,f={},v={},p={},h=0;return d.addReactiveFunction=o,d.makeNode=e,d.digest=c,d.makePropertyNode=n,d.makeReactiveFunctionNode=t,d.propertyNodeDidChange=u,d}function ReactiveFunction(e,n,t){var o={inProperties:e,outProperty:n,callback:t,inNodes:void 0,outNode:void 0};return o}function ReactiveModel(){function e(e,n){if(s)throw new Error("model.addPublicProperty() is being invoked after model.finalize, but this is not allowed. Public properties may only be added before the model is finalized.");return v[e]=n,f}function n(e){return v[e]}function t(){if(s)throw new Error("model.finalize() is being invoked more than once, but this function should only be invoked once.");return s=!0,Object.keys(v).forEach(function(e){c(e),f[e](n(e))}),f}function o(){var e={};return Object.keys(v).forEach(function(n){e[n]=p[n]}),e}function r(e){return Object.keys(v).forEach(function(e){var n=v[e];f[e](n)}),Object.keys(e).forEach(function(n){var t=e[n];f[n](t)}),f}function i(e){ReactiveFunction.parse(e).forEach(function(e){a(e),addReactiveFunction(e)})}function a(e){e.inNodes=e.inProperties.map(c),e.node=makeReactiveFunctionNode(e),e.outNode=c(e.outProperty)}function c(e){if(e in h)return h[e];var n=u(e),t=makePropertyNode(n);return f[e]=n,h[e]=t,t}function u(e){return function(n){return arguments.length?(p[e]=n,d(e),f):p[e]}}function d(e){var n=h[e];propertyNodeDidChange(n)}if(!(this instanceof ReactiveModel))return new ReactiveModel;var f=this,v={},p={},h={},s=!1;f.addPublicProperty=e,f.finalize=t,f.getState=o,f.setState=r,f.react=i}var reactiveGraph=new ReactiveGraph,addReactiveFunction=reactiveGraph.addReactiveFunction,makePropertyNode=reactiveGraph.makePropertyNode,makeReactiveFunctionNode=reactiveGraph.makeReactiveFunctionNode,propertyNodeDidChange=reactiveGraph.propertyNodeDidChange;ReactiveFunction.parse=function(e){return Object.keys(e).map(function(n){var t=e[n],o=t.splice(t.length-1)[0],r=t;return ReactiveFunction(r,n,o)})},ReactiveModel.digest=reactiveGraph.digest,ReactiveModel.Graph=Graph,ReactiveModel.ReactiveGraph=ReactiveGraph,ReactiveModel.ReactiveFunction=ReactiveFunction;var reactiveModel=ReactiveModel;module.exports=reactiveModel;