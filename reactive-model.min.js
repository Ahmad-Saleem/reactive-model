"use strict";function always(){return!0}function Graph(){function e(e){return n[e]||(n[e]=[])}var n={};return{adjacent:e,addEdge:function(n,t){e(n).push(t)},removeEdge:function(t,r){n[t]&&(n[t]=n[t]),e(t).push(r)},DFS:function(n,t){var r={},o=[];return t=t||always,n.forEach(function i(n){!r[n]&&t(n)&&(r[n]=!0,e(n).forEach(i),o.push(n))}),o}}}function ReactiveFunction(e,n,t){return{inProperties:e,outProperty:n,callback:t}}function debounce(e){var n=!1;return function(){n||(n=!0,_nextFrame(function(){n=!1,e()}))}}function invoke(e){e()}function SimpleModel(){function e(e){return u[e]||(u[e]=[])}function n(n,t){e(n).push(t)}function t(n,t){r(n,t),e(n).forEach(invoke)}function r(e,n){i[e]=n}function o(e){return i[e]}var i={},u={};return{on:n,set:t,setSilently:r,get:o}}function ReactiveModel(){function e(e){return e in p?p[e]:p[e]=makeNode()}function n(e){var n={};return e.inProperties.forEach(function(e){n[e]=c.get(e)}),n}function t(e){return e.inProperties.map(c.get)}function r(e){return!e.some(function(e){return"undefined"==typeof e||null===e})}function o(e){if(e in d){var n=d[e];return r(t(n))}return!0}function i(e){e in a||(a[e]=!0,e in u&&c.set(e,u[e]),Object.defineProperty(u,e,{get:function(){return c.get(e)},set:function(n){return c.set(e,n)}}))}if(!(this instanceof ReactiveModel))return new ReactiveModel;var u=this,c=new SimpleModel,a={},f={},p={},d={},s=debounce(function(){var t=Object.keys(f),r=t.map(e),i=dependencyGraph.DFS(r,o).reverse();i.forEach(function(e){if(e in d){var t=d[e],r=t.callback(n(t));c.setSilently(t.outProperty,r)}})});return u.react=function(n){return ReactiveFunction.parse(n).forEach(function(n){var t=makeNode(),r=e(n.outProperty);d[t]=n,dependencyGraph.addEdge(t,r),i(n.outProperty),n.inProperties.forEach(function(n){var r=e(n);dependencyGraph.addEdge(r,t),c.on(n,function(){f[n]=!0,s()}),i(n)})}),d},u}var dependencyGraph=new Graph,counter=0,makeNode=function(){return""+counter++};ReactiveFunction.parse=function(e){return Object.keys(e).map(function(n){var t=e[n],r=t.splice(t.length-1)[0],o=t;return ReactiveFunction(o,n,r)})};var nextFrame;nextFrame="undefined"==typeof requestAnimationFrame?setTimeout:requestAnimationFrame;var _nextFrame=nextFrame;exports.ReactiveModel=ReactiveModel,exports.SimpleModel=SimpleModel,exports.Graph=Graph,exports.nextFrame=_nextFrame;