"use strict";function Graph(){function e(e){return r[e]||(r[e]=[])}function t(t,n){e(t).push(n)}function n(t,n){r[t]&&(r[t]=r[t]),e(t).push(n)}function o(t,n){var o={},r=[];return n||(n=function(){return!0}),t.forEach(function i(t){!o[t]&&n(t)&&(o[t]=!0,e(t).forEach(i),r.push(t))}),r}var r={};return{adjacent:e,addEdge:t,removeEdge:n,DFS:o}}function ReactiveGraph(){function e(){return f++}function t(t){var n=e();return c[n]=t,n}function n(t){var n=e();return u[n]=t,n}function o(e){if(void 0===e.inNodes||void 0===e.outNode)throw new Error("Attempting to add a reactive function that doesn't have inNodes or outNode defined first.");e.inNodes.forEach(function(t){a.addEdge(t,e.node)}),a.addEdge(e.node,e.outNode)}function r(e){var t=e.inNodes.map(function(e){return c[e]()}),n=e.callback.apply(null,t);c[e.outNode](n)}function i(){var e=Object.keys(d),t=a.DFS(e).reverse();t.forEach(function(e){e in u&&r(u[e])}),e.forEach(function(e){delete d[e]})}var a=new Graph,c={},u={},d={},f=0;return a.addReactiveFunction=o,a.makeNode=e,a.digest=i,a.changedPropertyNodes=d,a.makePropertyNode=t,a.makeReactiveFunctionNode=n,a}function ReactiveFunction(e,t,n){return{inProperties:e,outProperty:t,callback:n,inNodes:void 0,outNode:void 0}}function ReactiveModel(){function e(e,t){if(f)throw new Error("model.addPublicProperty() is being invoked after model.finalize, but this is not allowed. Public properties may only be added before the model is finalized.");return d[e]=t,v[e]=t,u}function t(e){e.forEach(function(e){u[e]=function(t){if(!arguments.length)return v[e];v[e]=t;var n=s[e];return reactiveGraph.changedPropertyNodes[n]=!0,u}})}function n(){if(f)throw new Error("model.finalize() is being invoked more than once, but this function should only be invoked once.");return f=!0,t(Object.keys(d)),u}function o(){var e={};return Object.keys(d).forEach(function(t){e[t]=v[t]}),e}function r(e){return Object.keys(d).forEach(function(e){var t=d[e];u[e](t)}),Object.keys(e).forEach(function(t){var n=e[t];u[t](n)}),u}function i(e){var n=ReactiveFunction.parse(e);n.forEach(function(e){t(e.inProperties),t([e.outProperty]),c(e),reactiveGraph.addReactiveFunction(e),e.inNodes.forEach(function(e){reactiveGraph.changedPropertyNodes[e]=!0})})}function a(e){if(e in s)return s[e];var t=reactiveGraph.makePropertyNode(u[e]);return s[e]=t,t}function c(e){e.inNodes=e.inProperties.map(a),e.node=reactiveGraph.makeReactiveFunctionNode(e),e.outNode=a(e.outProperty)}if(!(this instanceof ReactiveModel))return new ReactiveModel;var u=this,d={},f=!1,v={},s={};u.addPublicProperty=e,u.finalize=n,u.getState=o,u.setState=r,u.react=i}var reactiveGraph=new ReactiveGraph;ReactiveFunction.parse=function(e){return Object.keys(e).map(function(t){var n=e[t],o=n.splice(n.length-1)[0],r=n;return ReactiveFunction(r,t,o)})},ReactiveModel.digest=reactiveGraph.digest,ReactiveModel.Graph=Graph,ReactiveModel.ReactiveGraph=ReactiveGraph,ReactiveModel.ReactiveFunction=ReactiveFunction;var reactiveModel=ReactiveModel;module.exports=reactiveModel;