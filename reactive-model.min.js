"use strict";function Graph(){function e(e){return r[e]||(r[e]=[])}function t(t,n){e(t).push(n)}function n(t,n){r[t]&&(r[t]=r[t]),e(t).push(n)}function o(t,n){var o={},r=[];return n||(n=function(){return!0}),t.forEach(function i(t){!o[t]&&n(t)&&(o[t]=!0,e(t).forEach(i),r.push(t))}),r}var r={};return{adjacent:e,addEdge:t,removeEdge:n,DFS:o}}function ReactiveGraph(){function e(){return v++}function t(t){var n=e();return c[n]=t,n}function n(t){var n=e();return d[n]=t,n}function o(e){if(void 0===e.inNodes||void 0===e.outNode)throw new Error("Attempting to add a reactive function that doesn't have inNodes or outNode defined first.");e.inNodes.forEach(function(t){a.addEdge(t,e.node)}),a.addEdge(e.node,e.outNode)}function r(e){var t=e.inNodes.map(function(e){return c[e]()}),n=e.callback.apply(null,t);c[e.outNode](n)}function i(){var e=Object.keys(u),t=a.DFS(e).reverse();t.forEach(function(e){e in d&&r(d[e])}),e.forEach(function(e){delete u[e]})}var a=new Graph,c={},d={},u={},v=0;return a.addReactiveFunction=o,a.makeNode=e,a.digest=i,a.changedPropertyNodes=u,a.makePropertyNode=t,a.makeReactiveFunctionNode=n,a}function ReactiveFunction(e,t,n){return{inProperties:e,outProperty:t,callback:n,inNodes:void 0,outNode:void 0}}function ReactiveModel(){function e(e,t){if(v)throw new Error("model.addPublicProperty() is being invoked after model.finalize, but this is not allowed. Public properties may only be added before the model is finalized.");return u[e]=t,f[e]=t,d}function t(e){return function(t){if(!arguments.length)return f[e];f[e]=t;var n=s[e];return changedPropertyNodes[n]=!0,d}}function n(){if(v)throw new Error("model.finalize() is being invoked more than once, but this function should only be invoked once.");return v=!0,Object.keys(u).map(a),d}function o(){var e={};return Object.keys(u).forEach(function(t){e[t]=f[t]}),e}function r(e){return Object.keys(u).forEach(function(e){var t=u[e];d[e](t)}),Object.keys(e).forEach(function(t){var n=e[t];d[t](n)}),d}function i(e){var t=ReactiveFunction.parse(e);t.forEach(function(e){c(e),addReactiveFunction(e),e.inNodes.forEach(function(e){changedPropertyNodes[e]=!0})})}function a(e){if(e in s)return s[e];var n=t(e);d[e]=n;var o=makePropertyNode(n);return s[e]=o,o}function c(e){e.inNodes=e.inProperties.map(a),e.node=makeReactiveFunctionNode(e),e.outNode=a(e.outProperty)}if(!(this instanceof ReactiveModel))return new ReactiveModel;var d=this,u={},v=!1,f={},s={};d.addPublicProperty=e,d.finalize=n,d.getState=o,d.setState=r,d.react=i}var reactiveGraph=new ReactiveGraph,changedPropertyNodes=reactiveGraph.changedPropertyNodes;ReactiveFunction.parse=function(e){return Object.keys(e).map(function(t){var n=e[t],o=n.splice(n.length-1)[0],r=n;return ReactiveFunction(r,t,o)})};var addReactiveFunction=reactiveGraph.addReactiveFunction,makePropertyNode=reactiveGraph.makePropertyNode,makeReactiveFunctionNode=reactiveGraph.makeReactiveFunctionNode;ReactiveModel.digest=reactiveGraph.digest,ReactiveModel.Graph=Graph,ReactiveModel.ReactiveGraph=ReactiveGraph,ReactiveModel.ReactiveFunction=ReactiveFunction;var reactiveModel=ReactiveModel;module.exports=reactiveModel;