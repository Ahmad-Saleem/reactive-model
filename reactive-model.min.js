"use strict";function Graph(){function e(e){return r[e]||(r[e]=[])}function n(n,t){e(n).push(t)}function t(n,t){r[n]&&(r[n]=r[n]),e(n).push(t)}function o(n,t){var o={},r=[];return t||(t=function(){return!0}),n.forEach(function i(n){!o[n]&&t(n)&&(o[n]=!0,e(n).forEach(i),r.push(n))}),r}var r={};return{adjacent:e,addEdge:n,removeEdge:t,DFS:o}}function ReactiveGraph(){function e(){return u++}function n(n){var t=e();return d[t]=n,t}function t(n){var t=e();return f[t]=n,t}function o(e,o){function r(e){var t=o[e];return n(t)}e.inNodes=e.inProperties.map(r),e.node=t(e),e.outNode=r(e.outProperty)}function r(e){if(void 0===e.inNodes||void 0===e.outNode)throw new Error("Attempting to add a reactive function that doesn't have inNodes or outNode defined first.");e.inNodes.forEach(function(n){c.addEdge(n,e.node)}),c.addEdge(e.node,e.outNode)}function i(e){var n=e.inNodes.map(function(e){return d[e]()}),t=e.callback.apply(null,n);d[e.outNode](t)}function a(){var e=Object.keys(v),n=c.DFS(e).reverse();n.forEach(function(e){e in f&&i(f[e])}),e.forEach(function(e){delete v[e]})}var c=new Graph,u=0,d={},f={},v={};return c.addReactiveFunction=r,c.assignNodes=o,c.makeNode=e,c.digest=a,c.changedPropertyNodes=v,c}function ReactiveFunction(e,n,t){return{inProperties:e,outProperty:n,callback:t,inNodes:void 0,outNode:void 0}}function ReactiveModel(){function e(e,n){if(u)throw new Error("model.addPublicProperty() is being invoked after model.finalize, but this is not allowed. Public properties may only be added before the model is finalized.");return c[e]=n,d[e]=n,a}function n(e){e.forEach(function(e){a[e]=function(n){if(!arguments.length)return d[e];d[e]=n;var t=f[e];return reactiveGraph.changedPropertyNodes[t]=!0,a}})}function t(){if(u)throw new Error("model.finalize() is being invoked more than once, but this function should only be invoked once.");return u=!0,n(Object.keys(c)),a}function o(){var e={};return Object.keys(c).forEach(function(n){e[n]=d[n]}),e}function r(e){return Object.keys(c).forEach(function(e){var n=c[e];a[e](n)}),Object.keys(e).forEach(function(n){var t=e[n];a[n](t)}),a}function i(e){var t=ReactiveFunction.parse(e);t.forEach(function(e){n(e.inProperties),n([e.outProperty]),reactiveGraph.assignNodes(e,a),reactiveGraph.addReactiveFunction(e),e.inNodes.forEach(function(e){reactiveGraph.changedPropertyNodes[e]=!0})})}if(!(this instanceof ReactiveModel))return new ReactiveModel;var a=this,c={},u=!1,d={},f={};a.addPublicProperty=e,a.finalize=t,a.getState=o,a.setState=r,a.react=i}var reactiveGraph=new ReactiveGraph;ReactiveFunction.parse=function(e){return Object.keys(e).map(function(n){var t=e[n],o=t.splice(t.length-1)[0],r=t;return ReactiveFunction(r,n,o)})},ReactiveModel.digest=reactiveGraph.digest,ReactiveModel.Graph=Graph,ReactiveModel.ReactiveGraph=ReactiveGraph,ReactiveModel.ReactiveFunction=ReactiveFunction;var reactiveModel=ReactiveModel;module.exports=reactiveModel;