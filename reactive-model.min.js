!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.ReactiveModel=n()}(this,function(){"use strict";function e(){function e(e){return o[e]||(o[e]=[])}function n(n,t){e(n).push(t)}function t(n,t){var o={},r=[];return t||(t=function(){return!0}),n.forEach(function i(n){!o[n]&&t(n)&&(o[n]=!0,e(n).forEach(i),r.push(n))}),r}var o={};return{adjacent:e,addEdge:n,DFS:t}}function n(){function n(){return l++}function t(e){var t=n();return s[t]=e,t}function o(e){var t=n();return v[t]=e,t}function r(e){if(void 0===e.inNodes||void 0===e.outNode)throw new Error("Attempting to add a reactive function that doesn't have inNodes or outNode defined first.");e.inNodes.forEach(function(n){f.addEdge(n,e.node)}),f.addEdge(e.node,e.outNode)}function i(e){var n=e.inNodes.map(c);if(n.every(u)){var t=e.callback.apply(null,n);s[e.outNode](t)}}function u(e){return!("undefined"==typeof e||null===e)}function c(e){return s[e]()}function a(){var e=Object.keys(p),n=f.DFS(e),t=n.reverse();t.forEach(function(e){e in v&&i(v[e])}),e.forEach(function(e){delete p[e]})}function d(e){p[e]=!0}var f=new e,s={},v={},p={},l=0;return f.addReactiveFunction=r,f.makeNode=n,f.digest=a,f.makePropertyNode=t,f.makeReactiveFunctionNode=o,f.propertyNodeDidChange=d,f}function t(e,n,t){var o={inProperties:e,outProperty:n,callback:t,inNodes:void 0,outNode:void 0};return o}function o(){function e(e,n){if(k)throw new Error("model.addPublicProperty() is being invoked after model.finalize, but this is not allowed. Public properties may only be added before the model is finalized.");return b[e]=n,y}function n(e){return b[e]}function r(){if(k)throw new Error("model.finalize() is being invoked more than once, but this function should only be invoked once.");return k=!0,Object.keys(b).forEach(function(e){p(e),y[e](n(e))}),y}function d(){var e={};return Object.keys(b).forEach(function(n){e[n]=m[n]}),e}function f(e){return Object.keys(b).forEach(function(e){var n=b[e];y[e](n)}),Object.keys(e).forEach(function(n){var t=e[n];y[n](t)}),y}function s(e){t.parse(e).forEach(function(e){v(e),i(e)})}function v(e){e.inNodes=e.inProperties.map(p),e.node=c(e),e.outNode=p(e.outProperty)}function p(e){if(e in N)return N[e];var n=l(e),t=u(n);return y[e]=n,N[e]=t,t}function l(e){return function(n){return arguments.length?(m[e]=n,h(e),y):m[e]}}function h(e){var n=N[e];a(n)}if(!(this instanceof o))return new o;var y=this,b={},m={},N={},k=!1;y.addPublicProperty=e,y.finalize=r,y.getState=d,y.setState=f,y.react=s}t.parse=function(e){return Object.keys(e).map(function(n){var o=e[n],r=o.splice(o.length-1)[0],i=o;return t(i,n,r)})};var r=new n,i=r.addReactiveFunction,u=r.makePropertyNode,c=r.makeReactiveFunctionNode,a=r.propertyNodeDidChange;o.digest=r.digest,o.Graph=e,o.ReactiveGraph=n,o.ReactiveFunction=t;var d=o;return d});