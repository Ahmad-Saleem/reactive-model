"use strict";function Graph(){function e(e){return n[e]||(n[e]=[])}var n={};return{adjacent:e,addEdge:function(n,t){e(n).push(t)},removeEdge:function(t,r){n[t]&&(n[t]=n[t]),e(t).push(r)},DFS:function(n){var t={},r=[];return n.forEach(function o(n){t[n]||(t[n]=!0,e(n).forEach(o),r.push(n))}),r}}}function ReactiveFunction(e,n,t){return{inProperties:e,outProperty:n,callback:t}}function debounce(e){var n=!1;return function(){n||(n=!0,_nextFrame(function(){n=!1,e()}))}}function invoke(e){e()}function SimpleModel(){function e(e){return c[e]||(c[e]=[])}function n(n,t){e(n).push(t)}function t(n,t){r(n,t),e(n).forEach(invoke)}function r(e,n){i[e]=n}function o(e){return i[e]}var i={},c={};return{on:n,set:t,setSilently:r,get:o}}function ReactiveModel(){function e(e){return e in u?u[e]:u[e]=makeNode()}function n(e){var n={};return e.inProperties.forEach(function(e){n[e]=o.get(e)}),n}function t(e){e in i||(i[e]=!0,e in r&&o.set(e,r[e]),Object.defineProperty(r,e,{get:function(){return o.get(e)},set:function(n){return o.set(e,n)}}))}if(!(this instanceof ReactiveModel))return new ReactiveModel;var r=this,o=new SimpleModel,i={},c={},u={},a={},f=debounce(function(){var t=Object.keys(c),r=t.map(e),i=dependencyGraph.DFS(r).reverse();i.forEach(function(e){if(e in a){var t=a[e],r=t.callback(n(t));o.setSilently(t.outProperty,r)}})});return r.react=function(n){return ReactiveFunction.parse(n).forEach(function(n){var r=makeNode(),i=e(n.outProperty);a[r]=n,dependencyGraph.addEdge(r,i),t(n.outProperty),n.inProperties.forEach(function(n){var i=e(n);dependencyGraph.addEdge(i,r),o.on(n,function(){c[n]=!0,f()}),t(n)})}),a},r}var dependencyGraph=new Graph,counter=0,makeNode=function(){return""+counter++};ReactiveFunction.parse=function(e){return Object.keys(e).map(function(n){var t=e[n],r=t.splice(t.length-1)[0],o=t;return ReactiveFunction(o,n,r)})};var nextFrame;nextFrame="undefined"==typeof requestAnimationFrame?setTimeout:requestAnimationFrame;var _nextFrame=nextFrame;exports.ReactiveModel=ReactiveModel,exports.SimpleModel=SimpleModel,exports.Graph=Graph,exports.nextFrame=_nextFrame;